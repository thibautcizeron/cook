{% extends "base/base.html" %}
{% load static %}

{% block title %}Entr√©es - Recettes{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
    <!-- Header avec titre et bouton -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0">
        <h1 class="text-2xl sm:text-3xl lg:text-4xl text-white font-bold text-center sm:text-left">
            D√©couvrez nos d√©licieuses entr√©es ü•ó
        </h1>
        {% if is_contributor or is_admin or is_superuser %}
            <a href="{% url 'recipe_add' %}" 
               class="bg-green-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg shadow-md hover:bg-green-700 transition duration-300 text-center text-sm sm:text-base font-medium inline-flex items-center justify-center">
                <span class="hidden sm:inline">+ Ajouter une entr√©e</span>
                <span class="sm:hidden">+ Ajouter</span>
            </a>
        {% endif %}
    </div>

    <!-- Grille responsive des entr√©es -->
    <div class="entrees-grid gap-3 sm:gap-4 lg:gap-5">
        {% for entree in entrees %}
            <div class="bg-white shadow-lg rounded-lg overflow-hidden transform hover:scale-105 transition-all duration-300 hover:shadow-xl w-full">
                <!-- Image de l'entr√©e -->
                <a href="{% url 'recipe_details' entree.id %}" class="block">
                    {% if entree.image %}
                        <img src="{% static entree.image %}" 
                             alt="{{ entree.titre }}" 
                             class="w-full h-28 sm:h-32 md:h-36 lg:h-40 object-cover">
                    {% else %}
                        <div class="w-full h-28 sm:h-32 md:h-36 lg:h-40 bg-gradient-to-br from-green-200 to-orange-300 flex items-center justify-center text-gray-600">
                            <div class="text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" 
                                     class="h-6 w-6 lg:h-8 lg:w-8 mx-auto mb-1" 
                                     fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16l-3-9m3 9l3-9" />
                                </svg>
                                <span class="text-xs lg:text-sm">ü•ó Entr√©e</span>
                            </div>
                        </div>
                    {% endif %}
                </a>

                <!-- Contenu de la carte -->
                <div class="p-3 lg:p-4">
                    <!-- Titre de l'entr√©e -->
                    <h2 class="text-base sm:text-lg lg:text-xl font-semibold mb-2 line-clamp-2">
                        <a href="{% url 'recipe_details' entree.id %}" 
                           class="hover:text-green-500 transition duration-200 block">
                            {{ entree.titre }}
                        </a>
                    </h2>
                    
                    <!-- Nombre de personnes -->
                    {% if entree.nbpersonne %}
                        <div class="flex items-center text-gray-600 text-xs lg:text-sm mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" 
                                 class="h-3 w-3 lg:h-4 lg:w-4 mr-1 flex-shrink-0" 
                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <span class="truncate">{{ entree.nbpersonne }} personne{{ entree.nbpersonne|pluralize }}</span>
                        </div>
                    {% endif %}

                    <!-- Cat√©gorie -->
                    {% if entree.categorie %}
                        <div class="flex items-center mb-2">
                            {% if entree.categorie.image %}
                                <img src="{% static entree.categorie.image %}" 
                                     alt="{{ entree.categorie.nom }}" 
                                     class="w-3 h-3 lg:w-4 lg:h-4 rounded-full mr-1 flex-shrink-0">
                            {% endif %}
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs lg:text-sm font-medium truncate">
                                {{ entree.categorie.nom|capfirst }}
                            </span>
                        </div>
                    {% endif %}

                    <!-- Note moyenne -->
                    {% if entree.note_moyenne > 0 %}
                        <div class="flex items-center justify-between mt-2">
                            <div class="flex text-yellow-400">
                                {% for i in "12345"|make_list %}
                                    {% if forloop.counter <= entree.note_moyenne %}
                                        <span class="text-xs lg:text-sm">‚òÖ</span>
                                    {% else %}
                                        <span class="text-xs lg:text-sm text-gray-300">‚òÖ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="text-xs lg:text-sm text-gray-500 ml-2 flex-shrink-0">
                                ({{ entree.note_moyenne|floatformat:1 }})
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Message si aucune entr√©e -->
    {% if not entrees %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ü•ó</div>
            <h3 class="text-xl text-white mb-2">Aucune entr√©e disponible</h3>
            <p class="text-gray-400">Revenez plus tard pour d√©couvrir nos cr√©ations !</p>
        </div>
    {% endif %}
</div>

<style>
    /* Grille avec taille r√©duite des cartes */
    .entrees-grid {
        display: grid;
        grid-template-columns: 1fr;
        justify-content: start;
    }

    /* Mobile : 1 colonne */
    @media (max-width: 374px) {
        .entrees-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Petit mobile : 2 colonnes */
    @media (min-width: 375px) {
        .entrees-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Tablette portrait : 3 colonnes */
    @media (min-width: 640px) {
        .entrees-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    /* Tablette paysage : 4 colonnes */
    @media (min-width: 768px) {
        .entrees-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* Desktop : colonnes avec largeur r√©duite */
    @media (min-width: 1024px) {
        .entrees-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            max-width: none;
        }
    }

    /* Large desktop : largeur r√©duite optimale */
    @media (min-width: 1280px) {
        .entrees-grid {
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        }
    }

    /* Animations et effets hover */
    .bg-white:hover {
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    /* Gradient personnalis√© pour les images manquantes */
    .bg-gradient-to-br {
        background: linear-gradient(135deg, #bbf7d0 0%, #fed7aa 100%);
    }

    /* Limitation du nombre de lignes pour le titre */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.3;
        max-height: 2.6em;
    }

    /* Am√©liorations pour le touch sur mobile */
    @media (hover: none) and (pointer: coarse) {
        .transform:hover {
            transform: none;
        }
        
        .bg-white:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
    }

    /* Am√©liorations pour les √©crans haute densit√© */
    @media (-webkit-min-device-pixel-ratio: 2) {
        .shadow-lg {
            box-shadow: 0 8px 12px -3px rgba(0, 0, 0, 0.1), 0 3px 5px -2px rgba(0, 0, 0, 0.05);
        }
    }

    /* Optimisation pour les tr√®s petits √©crans */
    @media (max-width: 374px) {
        .grid {
            grid-template-columns: 1fr;
        }
        
        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }
    }

    /* Am√©liorations pour tablette en mode paysage */
    @media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
        .entrees-grid {
            grid-template-columns: repeat(5, minmax(0, 1fr));
        }
    }

    /* Focus states pour l'accessibilit√© */
    a:focus {
        outline: 2px solid #10b981;
        outline-offset: 2px;
        border-radius: 4px;
    }

    /* Am√©lioration de la lisibilit√© sur petits √©crans */
    @media (max-width: 640px) {
        .text-2xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }
    }

    /* Styles sp√©cifiques pour les tags d'ingr√©dients */
    .bg-gray-100 {
        background-color: #f3f4f6;
    }
    
    .text-gray-700 {
        color: #374151;
    }
    
    .text-gray-500 {
        color: #6b7280;
    }

    /* Am√©lioration de l'espacement des tags */
    .flex-wrap {
        flex-wrap: wrap;
    }
    
    .gap-1 {
        gap: 0.25rem;
    }
</style>
{% endblock %}